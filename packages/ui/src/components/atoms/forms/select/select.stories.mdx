import { ArgsTable, Canvas, Meta, Story } from '@storybook/addon-docs';
import { useState } from 'react';
import { Select } from './select';

<Meta
  title="Components/Atoms/Forms/Select"
  component={Select}
  args={{
    isDisabled: false,
    isRequired: false,
    multiple: false,
  }}
  argTypes={{
    id: {
      control: {
        type: null,
      },
      description: 'Set an id to the select element.',
      table: {
        category: 'Attributes',
      },
      type: {
        name: 'string',
        required: false,
      },
    },
    isDisabled: {
      control: {
        type: 'boolean',
      },
      description: 'Should the field be disabled?',
      table: {
        category: 'Options',
        defaultValue: { summary: false },
      },
      type: {
        name: 'boolean',
        required: false,
      },
    },
    isRequired: {
      control: {
        type: 'boolean',
      },
      description: 'Is the select field required?',
      table: {
        category: 'Options',
        defaultValue: { summary: false },
      },
      type: {
        name: 'boolean',
        required: false,
      },
    },
    multiple: {
      control: {
        type: 'boolean',
      },
      description: 'Allow user to select multiple values.',
      table: {
        category: 'Options',
        defaultValue: { summary: false },
      },
      type: {
        name: 'boolean',
        required: false,
      },
    },
    name: {
      control: {
        type: null,
      },
      description: 'A select name.',
      table: {
        category: 'Attributes',
      },
      type: {
        name: 'string',
        required: true,
      },
    },
    options: {
      control: {
        type: null,
      },
      description: 'The options to display.',
      type: {
        name: 'object',
        required: true,
      },
    },
    placeholder: {
      control: {
        type: 'text',
      },
      description: 'Show a default value not selectable by user.',
      table: {
        category: 'Options',
      },
      type: {
        name: 'string',
        required: false,
      },
    },
    size: {
      control: {
        type: 'number',
      },
      if: { arg: 'multiple', eq: true },
      description: 'Control how much of the input is shown.',
      table: {
        category: 'Options',
      },
      type: {
        name: 'number',
        required: false,
      },
    },
    value: {
      control: {
        type: null,
      },
      description: 'The selected value.',
      type: {
        name: 'string',
        required: true,
      },
    },
  }}
/>

export const useSelect = (defaultValue, isMultiple) => {
  const [selected, setSelected] = useState();
  const handler = (e) => {
    const value = isMultiple
      ? Array.from(e.target.selectedOptions, (option) => option.value)
      : e.target.value;
    setSelected(value);
  };
  return { handler, selected };
};

export const Template = ({
  multiple,
  onChange: _onChange,
  placeholder,
  value: _value,
  ...args
}) => {
  const { handler, selected } = useSelect(
    placeholder ? '' : undefined,
    multiple
  );
  return (
    <Select
      {...args}
      multiple={multiple}
      onChange={handler}
      placeholder={placeholder}
      value={selected}
    />
  );
};

export const options = [
  { label: 'Option 1', value: 'option-1' },
  { label: 'Option 2', value: 'option-2' },
  { label: 'Option 3', value: 'option-3' },
  { label: 'Option 4', value: 'option-4' },
  { label: 'Option 5', value: 'option-5' },
];

export const optionsWithDisabled = [
  { label: 'Option 1', value: 'option-1' },
  { label: 'Option 2', value: 'option-2', isDisabled: true },
  { label: 'Option 3', value: 'option-3', isDisabled: true },
  { label: 'Option 4', value: 'option-4' },
  { label: 'Option 5', value: 'option-5' },
];

# Select

A select is used for collecting user provided information from a list of options.

## Single choice

By default, an user can select only one option in the select menu.

Different states are possible:

- selectable (default): the user can select an option,
- disabled: the user cannot interact with the select field,
- disabled options: the user can interact with the select field but some options are not selectable.

<Canvas>
  <Story
    name="Single choice: selectable"
    args={{
      id: 'default-field',
      name: 'default-field',
      options,
    }}
  >
    {Template.bind({})}
  </Story>
  <Story
    name="Single choice: disabled"
    args={{
      id: 'disabled-field',
      isDisabled: true,
      name: 'disabled-field',
      options,
    }}
  >
    {Template.bind({})}
  </Story>
  <Story
    name="Single choice: disabled options"
    args={{
      id: 'disabled-options',
      name: 'disabled-options',
      options: optionsWithDisabled,
    }}
  >
    {Template.bind({})}
  </Story>
</Canvas>

## Multiple choices

When using `multiple`, an user can select multiple options in the select menu.

Different states are possible:

- selectable (default): the user can select multiple options,
- disabled: the user cannot interact with the select field,
- disabled options: the user can interact with the select field but some options are not selectable.

<Canvas>
  <Story
    name="Multiple: selectable"
    args={{
      id: 'multiple-field',
      multiple: true,
      name: 'multiple-field',
      options: options,
    }}
  >
    {Template.bind({})}
  </Story>
  <Story
    name="Multiple: disabled"
    args={{
      id: 'disabled-multiple-field',
      isDisabled: true,
      multiple: true,
      name: 'disabled-multiple-field',
      options: options,
    }}
  >
    {Template.bind({})}
  </Story>
  <Story
    name="Multiple: disabled options"
    args={{
      id: 'multiple-disabled-options',
      multiple: true,
      name: 'multiple-disabled-options',
      options: optionsWithDisabled,
    }}
  >
    {Template.bind({})}
  </Story>
</Canvas>

## Placeholder

You can provide a "_placeholder_" used as default value and not selectable by the user.

<Canvas>
  <Story
    name="Placeholder"
    args={{
      id: 'placeholder-field',
      name: 'placeholder-field',
      options,
      placeholder: 'Select...',
    }}
  >
    {Template.bind({})}
  </Story>
</Canvas>

## Playground

<Canvas>
  <Story
    name="Playground"
    args={{
      id: 'playground-field',
      name: 'playground-field',
      options,
    }}
  >
    {Template.bind({})}
  </Story>
</Canvas>

<ArgsTable story="Playground" />
